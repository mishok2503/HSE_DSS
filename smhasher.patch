From 57e87fbf822052b367ddae826388d797f0b794a2 Mon Sep 17 00:00:00 2001
From: Mikhail Petrochenkov <mishok2503@mail.ru>
Date: Sat, 19 Mar 2022 22:01:50 +0300
Subject: [PATCH] HSE_DSS patch

---
 src/CMakeLists.txt | 12 +-----------
 src/SpeedTest.cpp  | 11 +++++++----
 2 files changed, 8 insertions(+), 15 deletions(-)

diff --git a/src/CMakeLists.txt b/src/CMakeLists.txt
index 3aaec87..d2766d2 100644
--- a/src/CMakeLists.txt
+++ b/src/CMakeLists.txt
@@ -1,6 +1,6 @@
 project(SMHasher)
 
-cmake_minimum_required(VERSION 2.4)
+cmake_minimum_required(VERSION 3.22)
 
 set(CMAKE_BUILD_TYPE Release)
 
@@ -31,13 +31,3 @@ add_library(
   Types.cpp
   PMurHash.c
 )
-
-add_executable(
-  SMHasher
-  main.cpp
-)
-
-target_link_libraries(
-  SMHasher
-  SMHasherSupport
-)
diff --git a/src/SpeedTest.cpp b/src/SpeedTest.cpp
index d91f6e4..1613e17 100644
--- a/src/SpeedTest.cpp
+++ b/src/SpeedTest.cpp
@@ -228,15 +228,18 @@ void BulkSpeedTest ( pfHash hash, uint32_t seed )
 
 //-----------------------------------------------------------------------------
 
-void TinySpeedTest ( pfHash hash, int hashsize, int keysize, uint32_t seed, bool verbose, double & /*outCycles*/ )
+void TinySpeedTest ( pfHash hash, int hashsize, int keysize, uint32_t seed, bool verbose, double &outCycles )
 {
   const int trials = 999999;
-
-  if(verbose) printf("Small key speed test - %4d-byte keys - ",keysize);
   
   double cycles = SpeedTest(hash,seed,trials,keysize,0);
   
-  printf("%8.2f cycles/hash\n",cycles);  
+  if (verbose) {
+    printf("Small key speed test - %4d-byte keys - ",keysize);
+    printf("%8.2f cycles/hash\n",cycles);  
+  }
+
+  outCycles = cycles;
 }
 
 //-----------------------------------------------------------------------------
-- 
2.35.1

